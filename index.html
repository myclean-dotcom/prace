<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система расчета и оформления заявок</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #2d89ef;
        }

        h1 {
            color: #2d89ef;
            font-size: 2.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .manager-info {
            background: #e8f4ff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .manager-input {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .manager-input input {
            flex: 1;
            min-width: 250px;
            padding: 12px 15px;
            border: 2px solid #2d89ef;
            border-radius: 8px;
            font-size: 1rem;
            max-width: 400px;
        }

        .manager-input .manager-badge {
            background: #2d89ef;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .system-container {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .system-container {
                grid-template-columns: 1fr;
            }
        }

        .calculator-section, .order-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        h2 {
            color: #2d89ef;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h2 i {
            font-size: 1.5rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
            gap: 8px;
        }

        .form-group label .hint {
            color: #666;
            font-weight: normal;
            font-size: 0.9rem;
            font-style: italic;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2d89ef;
            box-shadow: 0 0 0 3px rgba(45, 137, 239, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .radio-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            background: #f9f9f9;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .radio-option:hover {
            background: #f0f7ff;
        }

        .radio-option.selected {
            background: #e8f4ff;
            border-color: #2d89ef;
        }

        input[type="radio"] {
            display: none;
        }

        .custom-radio {
            width: 18px;
            height: 18px;
            border: 2px solid #ccc;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .radio-option.selected .custom-radio {
            border-color: #2d89ef;
            background-color: #2d89ef;
        }

        .custom-radio:after {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
            display: none;
        }

        .radio-option.selected .custom-radio:after {
            display: block;
        }

        .radio-label {
            cursor: pointer;
            flex-grow: 1;
            font-size: 0.95rem;
        }

        .radio-label small {
            display: block;
            color: #666;
            font-size: 0.85rem;
            margin-top: 2px;
        }

        .inline-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .inline-field {
            display: flex;
            flex-direction: column;
        }

        .inline-field label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .inline-field input, .inline-field select {
            padding: 10px 12px;
            font-size: 0.95rem;
        }

        .difficulty-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
            border-left: 4px solid #2d89ef;
        }

        .difficulty-slider-container {
            margin-top: 15px;
        }

        .difficulty-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2d89ef;
            text-align: center;
            margin-bottom: 10px;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #4CAF50, #FF9800, #f44336);
            outline: none;
            margin: 10px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #2d89ef;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .difficulty-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #666;
        }

        .difficulty-label {
            text-align: center;
            padding: 5px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .difficulty-label:hover {
            background: #f0f0f0;
        }

        .difficulty-label.active {
            background: #e8f4ff;
            color: #2d89ef;
            font-weight: 600;
        }

        .difficulty-description {
            margin-top: 15px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #666;
            border: 1px solid #e0e0e0;
        }

        .difficulty-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .difficulty-example {
            background: white;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            border-left: 3px solid #ddd;
        }

        .difficulty-example.level-1 { border-left-color: #4CAF50; }
        .difficulty-example.level-2 { border-left-color: #8BC34A; }
        .difficulty-example.level-3 { border-left-color: #FFC107; }
        .difficulty-example.level-4 { border-left-color: #FF9800; }
        .difficulty-example.level-5 { border-left-color: #f44336; }

        .price-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .price-label {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .price-amount {
            font-size: 3rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .price-min {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .price-breakdown {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.95rem;
        }

        .breakdown-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.1rem;
            color: #2d89ef;
            padding-top: 12px;
            margin-top: 5px;
            border-top: 2px solid #eee;
        }

        .breakdown-label {
            color: #666;
        }

        .breakdown-value {
            font-weight: 600;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-calculate {
            background: #2d89ef;
            color: white;
        }

        .btn-calculate:hover {
            background: #1a7ae0;
            transform: translateY(-2px);
        }

        .btn-create-order {
            background: #4CAF50;
            color: white;
            margin-top: 20px;
        }

        .btn-create-order:hover {
            background: #3d8b40;
            transform: translateY(-2px);
        }

        .btn-reset {
            background: #f0f0f0;
            color: #333;
        }

        .btn-reset:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        .status {
            display: none;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-size: 0.95rem;
            text-align: center;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            color: #2d89ef;
            font-size: 0.95rem;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            text-decoration: none;
        }

        .action-btn.copy {
            background: #4CAF50;
            color: white;
        }

        .action-btn.copy:hover {
            background: #3d8b40;
            transform: translateY(-2px);
        }

        .action-btn.telegram {
            background: #0088cc;
            color: white;
        }

        .action-btn.telegram:hover {
            background: #0077b5;
            transform: translateY(-2px);
        }

        .action-btn.new {
            background: #FF9800;
            color: white;
        }

        .action-btn.new:hover {
            background: #e68900;
            transform: translateY(-2px);
        }

        .result-area {
            margin-top: 20px;
            background: #f1f1f1;
            padding: 20px;
            border-radius: 10px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            color: #2d89ef;
            cursor: help;
        }

        .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
            z-index: 1000;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .field-note {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .required::after {
            content: " *";
            color: #f44336;
        }

        .manager-only {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.95rem;
            color: #856404;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <i class="fas fa-calculator"></i>
                Система расчета и оформления заявок
                <i class="fas fa-file-invoice-dollar"></i>
            </h1>
            <p>Для менеджеров клининговой компании</p>
            
            <div class="manager-info">
                <div class="manager-input">
                    <div class="manager-badge">
                        <i class="fas fa-user-tie"></i>
                        Менеджер:
                    </div>
                    <input type="text" id="managerName" placeholder="Введите ваше имя" maxlength="50">
                </div>
                <div class="field-note">Имя менеджера будет указано в заявке</div>
            </div>
        </header>

        <div class="manager-only">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Внимание менеджера!</strong> Эта система предназначена для точного расчета стоимости и быстрого оформления заявок. Все цены являются ориентировочными "от". Коэффициент сложности помогает точнее определить стоимость.
        </div>

        <div class="system-container">
            <!-- ЛЕВАЯ КОЛОНКА: КАЛЬКУЛЯТОР -->
            <div class="calculator-section">
                <div class="section-header">
                    <h2><i class="fas fa-calculator"></i> Калькулятор стоимости</h2>
                </div>

                <div class="form-group">
                    <label class="required">Тип уборки <span class="hint">(выберите один)</span></label>
                    <div class="radio-group" id="cleaningType">
                        <div class="radio-option selected" data-value="maintenance" data-price="80">
                            <div class="custom-radio"></div>
                            <span class="radio-label">
                                Поддерживающая
                                <small>от 80 руб/м² • Стандартная уборка</small>
                            </span>
                        </div>
                        <div class="radio-option" data-value="general" data-price="100">
                            <div class="custom-radio"></div>
                            <span class="radio-label">
                                Генеральная
                                <small>от 100 руб/м² • Полная уборка</small>
                            </span>
                        </div>
                        <div class="radio-option" data-value="post-renovation" data-price="150">
                            <div class="custom-radio"></div>
                            <span class="radio-label">
                                После ремонта
                                <small>от 150 руб/м² • Строительная пыль, загрязнения</small>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="required">Площадь помещения <span class="hint">(в м²)</span></label>
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Площадь (м²)</label>
                            <input type="number" id="areaSize" min="10" max="1000" value="60" step="1" placeholder="Например: 85">
                        </div>
                        <div class="inline-field">
                            <label>Тип помещения</label>
                            <select id="roomType">
                                <option value="apartment" selected>Квартира</option>
                                <option value="office">Офис</option>
                                <option value="house">Дом</option>
                                <option value="industrial">Производственное</option>
                            </select>
                        </div>
                    </div>
                    <div class="field-note">Укажите точную площадь помещения для расчета</div>
                </div>

                <div class="difficulty-section">
                    <label class="required">Коэффициент сложности <span class="hint">(1-5, макс. +35%)</span></label>
                    <div class="difficulty-slider-container">
                        <div class="difficulty-value" id="difficultyValue">Уровень 1: Стандартная уборка (+0%)</div>
                        <input type="range" id="difficultySlider" min="1" max="5" value="1" step="1">
                        
                        <div class="difficulty-labels">
                            <div class="difficulty-label active" data-level="1">1<br><small>+0%</small></div>
                            <div class="difficulty-label" data-level="2">2<br><small>+8%</small></div>
                            <div class="difficulty-label" data-level="3">3<br><small>+17%</small></div>
                            <div class="difficulty-label" data-level="4">4<br><small>+26%</small></div>
                            <div class="difficulty-label" data-level="5">5<br><small>+35%</small></div>
                        </div>

                        <div class="difficulty-description">
                            <strong>Рекомендации менеджеру:</strong> Учитывайте степень загрязнения, количество мебели, высоту потолков, наличие домашних животных.
                        </div>

                        <div class="difficulty-examples">
                            <div class="difficulty-example level-1">
                                <strong>Уровень 1:</strong> Стандартная уборка, нормальное загрязнение
                            </div>
                            <div class="difficulty-example level-2">
                                <strong>Уровень 2:</strong> Легкие дополнительные загрязнения
                            </div>
                            <div class="difficulty-example level-3">
                                <strong>Уровень 3:</strong> Среднее загрязнение, наличие животных
                            </div>
                            <div class="difficulty-example level-4">
                                <strong>Уровень 4:</strong> Сильное загрязнение, много мебели
                            </div>
                            <div class="difficulty-example level-5">
                                <strong>Уровень 5:</strong> Домашние животные, сложные условия
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Дополнительные услуги <span class="hint">(опционально)</span></label>
                    
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Окна (створки)</label>
                            <input type="number" id="windowsCount" min="0" value="0" placeholder="Кол-во">
                        </div>
                        <div class="inline-field">
                            <label>Тип мойки</label>
                            <select id="windowsType">
                                <option value="200">С одной стороны (200 руб)</option>
                                <option value="400">С двух сторон (400 руб)</option>
                            </select>
                        </div>
                    </div>

                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Шкафы (шт)</label>
                            <input type="number" id="cabinetsCount" min="0" value="0" placeholder="Кол-во">
                        </div>
                        <div class="inline-field">
                            <label>Холодильники (шт)</label>
                            <input type="number" id="fridgeCount" min="0" value="0" placeholder="Кол-во">
                        </div>
                    </div>

                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Духовые шкафы (шт)</label>
                            <input type="number" id="ovenCount" min="0" value="0" placeholder="Кол-во">
                        </div>
                        <div class="inline-field">
                            <label>Вытяжки (шт)</label>
                            <input type="number" id="hoodCount" min="0" value="0" placeholder="Кол-во">
                        </div>
                    </div>

                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Мелкая техника (шт)</label>
                            <input type="number" id="appliancesCount" min="0" value="0" placeholder="Кол-во">
                        </div>
                        <div class="inline-field">
                            <label>Дальний выезд</label>
                            <select id="farTrip">
                                <option value="0">Нет</option>
                                <option value="1000">Да (+1000 руб)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="price-display">
                    <div class="price-label">Ориентировочная стоимость:</div>
                    <div class="price-amount" id="totalPrice">0 руб</div>
                    <div class="price-min">*Минимальный заказ: 3 500 руб</div>
                </div>

                <div class="price-breakdown">
                    <div class="breakdown-item">
                        <span class="breakdown-label">Базовая уборка:</span>
                        <span class="breakdown-value" id="basePrice">0 руб</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Доп. услуги:</span>
                        <span class="breakdown-value" id="extraPrice">0 руб</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Коэффициент сложности:</span>
                        <span class="breakdown-value" id="difficultyPrice">+0%</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Итоговая стоимость:</span>
                        <span class="breakdown-value" id="finalPrice">0 руб</span>
                    </div>
                </div>

                <div class="buttons">
                    <button class="btn-calculate" id="calculateBtn">
                        <i class="fas fa-calculator"></i> Рассчитать стоимость
                    </button>
                    <button class="btn-reset" id="resetBtn">
                        <i class="fas fa-redo"></i> Сбросить
                    </button>
                </div>
            </div>

            <!-- ПРАВАЯ КОЛОНКА: ФОРМА ЗАЯВКИ -->
            <div class="order-section">
                <div class="section-header">
                    <h2><i class="fas fa-file-alt"></i> Форма заявки</h2>
                </div>

                <div class="form-group">
                    <label class="required">Данные клиента</label>
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Имя клиента</label>
                            <input type="text" id="customerName" placeholder="Фамилия Имя">
                        </div>
                        <div class="inline-field">
                            <label>Телефон</label>
                            <input type="tel" id="customerPhone" placeholder="+7 (___) ___-____">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="required">Адрес уборки</label>
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Адрес</label>
                            <input type="text" id="customerAddress" placeholder="Улица, дом">
                        </div>
                        <div class="inline-field">
                            <label>Квартира/офис</label>
                            <input type="text" id="customerFlat" placeholder="Номер">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Дата и время уборки</label>
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Дата</label>
                            <input type="date" id="orderDate">
                        </div>
                        <div class="inline-field">
                            <label>Время</label>
                            <input type="time" id="orderTime">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Финансы <span class="hint">(автозаполнение из калькулятора)</span></label>
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Сумма заказа</label>
                            <input type="number" id="orderTotal" placeholder="Автозаполнение" readonly>
                        </div>
                        <div class="inline-field">
                            <label>Зарплата мастерам</label>
                            <select id="masterPayType" onchange="calculateMasterPay()">
                                <option value="60">60/40</option>
                                <option value="70">70/30</option>
                                <option value="fixed">Фиксированная</option>
                            </select>
                            <input type="number" id="masterPay" placeholder="Сумма" style="margin-top: 8px;">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Описание работ</label>
                    <textarea id="worksDescription" placeholder="Дополнительные пожелания, особенности помещения..."></textarea>
                </div>

                <div class="form-group">
                    <label>Оборудование и химия</label>
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Оборудование</label>
                            <select id="equipment" multiple style="height: 100px;">
                                <option value="Стремянка">Стремянка</option>
                                <option value="Пылесос">Пылесос</option>
                                <option value="Парогенератор">Парогенератор</option>
                                <option value="Мойщик окон">Мойщик окон</option>
                            </select>
                        </div>
                        <div class="inline-field">
                            <label>Химия</label>
                            <select id="chemistry" multiple style="height: 100px;">
                                <option value="Универсальное средство">Универсальное средство</option>
                                <option value="Средство от жира">Средство от жира</option>
                                <option value="Средство для сантехники">Средство для сантехники</option>
                                <option value="Антискотч">Антискотч</option>
                            </select>
                        </div>
                    </div>
                    <div class="field-note">Удерживайте Ctrl для выбора нескольких вариантов</div>
                </div>

                <button class="btn-create-order" id="createOrderBtn">
                    <i class="fas fa-file-invoice-dollar"></i> Создать заявку
                </button>

                <div id="status" class="status"></div>
                <div id="loading" class="loading">⏳ Обработка данных...</div>

                <div id="resultArea" class="result-area" style="display: none;"></div>

                <div class="action-buttons" id="actionButtons" style="display: none;">
                    <button class="action-btn copy" onclick="copyToClipboard()">
                        <i class="far fa-copy"></i> Копировать
                    </button>
                    <button class="action-btn telegram" onclick="sendToTelegram()">
                        <i class="fab fa-telegram"></i> Telegram
                    </button>
                    <button class="action-btn new" onclick="newOrder()">
                        <i class="fas fa-plus"></i> Новая
                    </button>
                </div>
            </div>
        </div>

        <footer>
            <p>© 2023 Система расчета и оформления заявок. Для внутреннего использования менеджерами.</p>
            <p style="margin-top: 5px; font-size: 0.8rem;">Все расчеты являются предварительными. Точную стоимость определяет менеджер.</p>
        </footer>
    </div>

    <script>
        // Константы
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwbAWTpykj4kPODmOdMvac5pPkouYlJWnOvQLtN-UUTChbjBf9VYwGaKVhfV0lnKlbU/exec';

        // Цены и коэффициенты
        const priceConfig = {
            cleaningTypes: {
                'maintenance': 80,
                'general': 100,
                'post-renovation': 150
            },
            extras: {
                'windows': { '200': 200, '400': 400 },
                'cabinets': 250,
                'fridge': 600,
                'oven': 500,
                'hood': 300,
                'appliances': 100,
                'farTrip': 1000
            },
            minOrder: 3500,
            // Новый коэффициент: 1-5, максимум +35%
            difficulty: {
                1: 1.00,   // +0%
                2: 1.08,   // +8%
                3: 1.17,   // +17%
                4: 1.26,   // +26%
                5: 1.35    // +35%
            },
            difficultyDescriptions: {
                1: "Уровень 1: Стандартная уборка, нормальный уровень загрязнения (+0%)",
                2: "Уровень 2: Легкие дополнительные загрязнения, немного мебели (+8%)",
                3: "Уровень 3: Среднее загрязнение, наличие животных (+17%)",
                4: "Уровень 4: Сильное загрязнение, много мебели и вещей (+26%)",
                5: "Уровень 5: Домашние животные, очень сложные условия, высокая загрязненность (+35%)"
            }
        };

        // Глобальные переменные
        let currentOrderData = null;
        let calculatedPrice = 0;

        // DOM элементы
        const managerNameInput = document.getElementById('managerName');
        const cleaningTypeOptions = document.querySelectorAll('#cleaningType .radio-option');
        const areaSizeInput = document.getElementById('areaSize');
        const roomTypeSelect = document.getElementById('roomType');
        const difficultySlider = document.getElementById('difficultySlider');
        const difficultyValue = document.getElementById('difficultyValue');
        const difficultyLabels = document.querySelectorAll('.difficulty-label');
        
        // Дополнительные услуги
        const windowsCount = document.getElementById('windowsCount');
        const windowsType = document.getElementById('windowsType');
        const cabinetsCount = document.getElementById('cabinetsCount');
        const fridgeCount = document.getElementById('fridgeCount');
        const ovenCount = document.getElementById('ovenCount');
        const hoodCount = document.getElementById('hoodCount');
        const appliancesCount = document.getElementById('appliancesCount');
        const farTrip = document.getElementById('farTrip');
        
        // Форма заявки
        const customerName = document.getElementById('customerName');
        const customerPhone = document.getElementById('customerPhone');
        const customerAddress = document.getElementById('customerAddress');
        const customerFlat = document.getElementById('customerFlat');
        const orderDate = document.getElementById('orderDate');
        const orderTime = document.getElementById('orderTime');
        const orderTotal = document.getElementById('orderTotal');
        const masterPayType = document.getElementById('masterPayType');
        const masterPay = document.getElementById('masterPay');
        const worksDescription = document.getElementById('worksDescription');
        
        // Кнопки
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const createOrderBtn = document.getElementById('createOrderBtn');
        
        // Отображение цены
        const totalPriceEl = document.getElementById('totalPrice');
        const basePriceEl = document.getElementById('basePrice');
        const extraPriceEl = document.getElementById('extraPrice');
        const difficultyPriceEl = document.getElementById('difficultyPrice');
        const finalPriceEl = document.getElementById('finalPrice');
        
        // Статус и результат
        const statusEl = document.getElementById('status');
        const loadingEl = document.getElementById('loading');
        const resultArea = document.getElementById('resultArea');
        const actionButtons = document.getElementById('actionButtons');

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Установка сегодняшней даты по умолчанию
            const today = new Date();
            orderDate.value = today.toISOString().split('T')[0];
            
            // Установка времени по умолчанию (через 2 часа)
            const twoHoursLater = new Date(today.getTime() + 2 * 60 * 60 * 1000);
            orderTime.value = twoHoursLater.toISOString().split('T')[1].substring(0, 5);
            
            // Обновление слайдера сложности
            updateDifficultyDisplay();
            
            // Обработчики событий для калькулятора
            cleaningTypeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    cleaningTypeOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    calculatePrice();
                });
            });

            areaSizeInput.addEventListener('input', calculatePrice);
            roomTypeSelect.addEventListener('change', calculatePrice);
            difficultySlider.addEventListener('input', updateDifficultyDisplay);
            
            // Обработчики для меток сложности
            difficultyLabels.forEach(label => {
                label.addEventListener('click', function() {
                    const level = parseInt(this.getAttribute('data-level'));
                    difficultySlider.value = level;
                    updateDifficultyDisplay();
                    calculatePrice();
                });
            });
            
            // Обработчики для дополнительных услуг
            const extraInputs = [windowsCount, windowsType, cabinetsCount, fridgeCount, 
                               ovenCount, hoodCount, appliancesCount, farTrip];
            extraInputs.forEach(input => {
                input.addEventListener('change', calculatePrice);
                input.addEventListener('input', calculatePrice);
            });
            
            // Кнопка расчета
            calculateBtn.addEventListener('click', calculatePrice);
            
            // Кнопка сброса
            resetBtn.addEventListener('click', resetCalculator);
            
            // Кнопка создания заявки
            createOrderBtn.addEventListener('click', createOrder);
            
            // Автоматический расчет при загрузке
            calculatePrice();
        });

        // Обновление отображения сложности
        function updateDifficultyDisplay() {
            const level = parseInt(difficultySlider.value);
            const percentage = Math.round((priceConfig.difficulty[level] - 1) * 100);
            
            difficultyValue.textContent = priceConfig.difficultyDescriptions[level];
            
            // Обновление активной метки
            difficultyLabels.forEach(label => {
                const labelLevel = parseInt(label.getAttribute('data-level'));
                label.classList.toggle('active', labelLevel === level);
                
                // Обновление процентов в метках
                const labelPercentage = Math.round((priceConfig.difficulty[labelLevel] - 1) * 100);
                label.querySelector('small').textContent = `+${labelPercentage}%`;
            });
        }

        // Расчет стоимости
        function calculatePrice() {
            // Получаем значения
            const cleaningType = document.querySelector('#cleaningType .radio-option.selected').getAttribute('data-value');
            const area = parseInt(areaSizeInput.value) || 10;
            const difficulty = parseInt(difficultySlider.value);
            
            // 1. Базовая стоимость
            let basePrice = priceConfig.cleaningTypes[cleaningType] * area;
            
            // 2. Дополнительные услуги
            let extraPrice = 0;
            
            // Окна
            const windowsPrice = parseInt(windowsType.value);
            extraPrice += (parseInt(windowsCount.value) || 0) * windowsPrice;
            
            // Другие услуги
            extraPrice += (parseInt(cabinetsCount.value) || 0) * priceConfig.extras.cabinets;
            extraPrice += (parseInt(fridgeCount.value) || 0) * priceConfig.extras.fridge;
            extraPrice += (parseInt(ovenCount.value) || 0) * priceConfig.extras.oven;
            extraPrice += (parseInt(hoodCount.value) || 0) * priceConfig.extras.hood;
            extraPrice += (parseInt(appliancesCount.value) || 0) * priceConfig.extras.appliances;
            
            // Дальний выезд
            if (farTrip.value === '1000') {
                extraPrice += priceConfig.extras.farTrip;
            }
            
            // 3. Общая стоимость до коэффициента
            let subtotal = basePrice + extraPrice;
            
            // 4. Минимальная сумма
            if (subtotal < priceConfig.minOrder) {
                subtotal = priceConfig.minOrder;
            }
            
            // 5. Применяем коэффициент сложности
            const difficultyMultiplier = priceConfig.difficulty[difficulty];
            let finalPrice = subtotal * difficultyMultiplier;
            
            // 6. Сохраняем расчетную цену
            calculatedPrice = finalPrice;
            
            // 7. Заполняем поле суммы в форме заявки
            orderTotal.value = Math.round(finalPrice);
            calculateMasterPay();
            
            // 8. Отображаем результаты
            displayPriceResults(basePrice, extraPrice, difficultyMultiplier, finalPrice);
        }

        // Отображение результатов расчета
        function displayPriceResults(basePrice, extraPrice, difficultyMultiplier, finalPrice) {
            const percentage = Math.round((difficultyMultiplier - 1) * 100);
            
            basePriceEl.textContent = formatPrice(basePrice);
            extraPriceEl.textContent = formatPrice(extraPrice);
            difficultyPriceEl.textContent = `+${percentage}%`;
            finalPriceEl.textContent = formatPrice(finalPrice);
            totalPriceEl.textContent = formatPrice(finalPrice);
        }

        // Форматирование цены
        function formatPrice(price) {
            return Math.round(price).toLocaleString('ru-RU') + ' руб';
        }

        // Расчет зарплаты мастерам
        function calculateMasterPay() {
            const total = parseFloat(orderTotal.value) || 0;
            const type = masterPayType.value;
            
            if (type === '60') {
                masterPay.value = Math.round(total * 0.6);
            } else if (type === '70') {
                masterPay.value = Math.round(total * 0.7);
            } else if (type === 'fixed') {
                // Оставляем пустым для ручного ввода
                if (!masterPay.value) masterPay.value = '';
            }
        }

        // Сброс калькулятора
        function resetCalculator() {
            // Сброс типа уборки
            cleaningTypeOptions.forEach(opt => opt.classList.remove('selected'));
            document.querySelector('#cleaningType .radio-option').classList.add('selected');
            
            // Сброс площади
            areaSizeInput.value = '60';
            roomTypeSelect.value = 'apartment';
            
            // Сброс сложности
            difficultySlider.value = '1';
            updateDifficultyDisplay();
            
            // Сброс дополнительных услуг
            windowsCount.value = '0';
            windowsType.value = '200';
            cabinetsCount.value = '0';
            fridgeCount.value = '0';
            ovenCount.value = '0';
            hoodCount.value = '0';
            appliancesCount.value = '0';
            farTrip.value = '0';
            
            calculatePrice();
            
            showStatus('Калькулятор сброшен', 'success');
        }

        // Показать статус
        function showStatus(message, type = 'success') {
            statusEl.className = 'status ' + type;
            statusEl.innerHTML = message;
            statusEl.style.display = 'block';
            
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }

        // Создание заявки
        function createOrder() {
            // Проверка менеджера
            const manager = managerNameInput.value.trim();
            if (!manager) {
                showStatus('❌ Укажите имя менеджера!', 'error');
                managerNameInput.focus();
                return;
            }
            
            // Проверка обязательных полей
            if (!customerName.value.trim()) {
                showStatus('❌ Укажите имя клиента!', 'error');
                customerName.focus();
                return;
            }
            
            if (!customerPhone.value.trim()) {
                showStatus('❌ Укажите телефон клиента!', 'error');
                customerPhone.focus();
                return;
            }
            
            if (!customerAddress.value.trim()) {
                showStatus('❌ Укажите адрес уборки!', 'error');
                customerAddress.focus();
                return;
            }
            
            // Генерация ID заказа
            const orderId = generateOrderId();
            
            // Получение выбранного оборудования и химии
            const equipment = getSelectedOptions('equipment');
            const chemistry = getSelectedOptions('chemistry');
            
            // Подготовка данных для отправки
            currentOrderData = {
                // Информация о менеджере
                manager: manager,
                orderId: orderId,
                
                // Данные калькулятора
                cleaningType: document.querySelector('#cleaningType .radio-option.selected').getAttribute('data-value'),
                area: parseInt(areaSizeInput.value) || 0,
                roomType: roomTypeSelect.value,
                difficulty: parseInt(difficultySlider.value),
                calculatedPrice: calculatedPrice,
                
                // Дополнительные услуги
                windowsCount: parseInt(windowsCount.value) || 0,
                windowsType: windowsType.value,
                cabinetsCount: parseInt(cabinetsCount.value) || 0,
                fridgeCount: parseInt(fridgeCount.value) || 0,
                ovenCount: parseInt(ovenCount.value) || 0,
                hoodCount: parseInt(hoodCount.value) || 0,
                appliancesCount: parseInt(appliancesCount.value) || 0,
                farTrip: farTrip.value === '1000' ? 'Да' : 'Нет',
                
                // Данные клиента
                customerName: customerName.value,
                customerPhone: customerPhone.value,
                customerAddress: customerAddress.value,
                customerFlat: customerFlat.value,
                orderDate: orderDate.value,
                orderTime: orderTime.value,
                orderTotal: orderTotal.value || '0',
                masterPay: masterPay.value || '0',
                worksDescription: worksDescription.value || '',
                equipment: equipment.join(', ') || '—',
                chemistry: chemistry.join(', ') || '—'
            };
            
            // Генерация текста заявки
            generateOrderText();
            
            // Показать кнопки действий
            resultArea.style.display = 'block';
            actionButtons.style.display = 'flex';
            
            // Автоматическая отправка в Google Таблицы
            saveToSheets();
        }

        // Генерация ID заказа
        function generateOrderId() {
            return 'CLN-' + Date.now().toString().slice(-8);
        }

        // Получение выбранных опций
        function getSelectedOptions(selectId) {
            const select = document.getElementById(selectId);
            const selected = [];
            for (let i = 0; i < select.options.length; i++) {
                if (select.options[i].selected) {
                    selected.push(select.options[i].value);
                }
            }
            return selected;
        }

        // Генерация текста заявки
        function generateOrderText() {
            if (!currentOrderData) return;
            
            // Получаем тип уборки по-русски
            let cleaningTypeText = '';
            switch(currentOrderData.cleaningType) {
                case 'maintenance': cleaningTypeText = 'Поддерживающая'; break;
                case 'general': cleaningTypeText = 'Генеральная'; break;
                case 'post-renovation': cleaningTypeText = 'После ремонта'; break;
            }
            
            // Получаем тип помещения по-русски
            let roomTypeText = '';
            switch(currentOrderData.roomType) {
                case 'apartment': roomTypeText = 'Квартира'; break;
                case 'office': roomTypeText = 'Офис'; break;
                case 'house': roomTypeText = 'Дом'; break;
                case 'industrial': roomTypeText = 'Производственное помещение'; break;
            }
            
            const text = 
`🧹 ЗАКАЗ НА УБОРКУ №${currentOrderData.orderId}

📋 ОБЩАЯ ИНФОРМАЦИЯ:
────────────────────
Менеджер: ${currentOrderData.manager}
Тип уборки: ${cleaningTypeText}
Площадь: ${currentOrderData.area} м²
Тип помещения: ${roomTypeText}
Коэффициент сложности: Уровень ${currentOrderData.difficulty} (+${Math.round((priceConfig.difficulty[currentOrderData.difficulty] - 1) * 100)}%)
Дата: ${currentOrderData.orderDate}
Время: ${currentOrderData.orderTime}

💰 ФИНАНСЫ:
──────────
Расчетная стоимость: ${formatPrice(currentOrderData.calculatedPrice)}
Сумма заказа: ${currentOrderData.orderTotal} руб
Зарплата мастерам: ${currentOrderData.masterPay} руб

👤 ДАННЫЕ КЛИЕНТА:
─────────────────
Имя: ${currentOrderData.customerName}
Телефон: ${currentOrderData.customerPhone}
Адрес: ${currentOrderData.customerAddress}
Квартира/офис: ${currentOrderData.customerFlat || '—'}

🔧 ДОПОЛНИТЕЛЬНЫЕ УСЛУГИ:
────────────────────────
Окна: ${currentOrderData.windowsCount} шт (${currentOrderData.windowsType === '200' ? 'с одной стороны' : 'с двух сторон'})
Шкафы: ${currentOrderData.cabinetsCount} шт
Холодильники: ${currentOrderData.fridgeCount} шт
Духовые шкафы: ${currentOrderData.ovenCount} шт
Вытяжки: ${currentOrderData.hoodCount} шт
Мелкая техника: ${currentOrderData.appliancesCount} шт
Дальний выезд: ${currentOrderData.farTrip}

🛠 ОБОРУДОВАНИЕ:
────────────────
${currentOrderData.equipment}

🧴 ХИМИЯ:
─────────
${currentOrderData.chemistry}

📝 ОПИСАНИЕ РАБОТ:
─────────────────
${currentOrderData.worksDescription || '—'}

────────────────────
✅ Заявка сформирована: ${new Date().toLocaleString('ru-RU')}
📷 Фото будут прикреплены в чате`;

            resultArea.textContent = text;
            window.scrollTo(0, resultArea.offsetTop - 100);
        }

        // Копирование в буфер обмена
        function copyToClipboard() {
            const text = resultArea.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showStatus('✅ Текст заявки скопирован в буфер обмена!', 'success');
            }).catch(err => {
                console.error('Ошибка копирования: ', err);
                showStatus('❌ Не удалось скопировать текст', 'error');
            });
        }

        // Отправка в Telegram
        function sendToTelegram() {
            if (!currentOrderData) {
                showStatus('❌ Сначала создайте заявку', 'error');
                return;
            }
            
            const text = resultArea.textContent;
            const telegramUrl = `https://t.me/share/url?url=&text=${encodeURIComponent(text)}`;
            window.open(telegramUrl, '_blank');
            showStatus('📨 Telegram открыт для отправки заявки', 'success');
        }

        // Новая заявка
        function newOrder() {
            // Сброс только формы клиента
            customerName.value = '';
            customerPhone.value = '';
            customerAddress.value = '';
            customerFlat.value = '';
            worksDescription.value = '';
            
            // Сброс выбранного оборудования и химии
            document.getElementById('equipment').selectedIndex = -1;
            document.getElementById('chemistry').selectedIndex = -1;
            
            // Скрываем результат
            resultArea.style.display = 'none';
            actionButtons.style.display = 'none';
            
            showStatus('✅ Форма клиента очищена. Можете создать новую заявку!', 'success');
            
            // Прокрутка к началу
            window.scrollTo(0, 0);
        }

        // Сохранение в Google Таблицы
        async function saveToSheets() {
            if (!currentOrderData) return;
            
            loadingEl.style.display = 'block';
            
            try {
                // Отправляем данные в Google Sheets
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(currentOrderData)
                });
                
                loadingEl.style.display = 'none';
                showStatus(`✅ Заявка №${currentOrderData.orderId} сохранена в Google Таблицу!`, 'success');
                
            } catch (error) {
                loadingEl.style.display = 'none';
                console.error('Ошибка:', error);
                
                // Альтернативный метод
                try {
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = GOOGLE_SCRIPT_URL;
                    form.target = '_blank';
                    
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'data';
                    input.value = JSON.stringify(currentOrderData);
                    form.appendChild(input);
                    
                    document.body.appendChild(form);
                    form.submit();
                    document.body.removeChild(form);
                    
                    showStatus(`✅ Заявка №${currentOrderData.orderId} отправлена (альтернативный метод)!`, 'success');
                } catch (e) {
                    showStatus('❌ Ошибка отправки в Google Таблицу', 'error');
                }
            }
        }
    </script>
</body>
</html>
