<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система расчета и оформления заявок</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #2d89ef;
        }

        h1 {
            color: #2d89ef;
            font-size: 2.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .manager-info {
            background: #e8f4ff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .manager-input {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .manager-input input {
            flex: 1;
            min-width: 250px;
            padding: 12px 15px;
            border: 2px solid #2d89ef;
            border-radius: 8px;
            font-size: 1rem;
            max-width: 400px;
        }

        .manager-input .manager-badge {
            background: #2d89ef;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .system-container {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .system-container {
                grid-template-columns: 1fr;
            }
        }

        .calculator-section, .order-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .order-section.active {
            border: 2px solid #2d89ef;
            box-shadow: 0 0 0 3px rgba(45, 137, 239, 0.1);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(45, 137, 239, 0.3); }
            70% { box-shadow: 0 0 0 10px rgba(45, 137, 239, 0); }
            100% { box-shadow: 0 0 0 0 rgba(45, 137, 239, 0); }
        }

        h2 {
            color: #2d89ef;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h2 i {
            font-size: 1.5rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
            gap: 8px;
        }

        .form-group label .hint {
            color: #666;
            font-weight: normal;
            font-size: 0.9rem;
            font-style: italic;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2d89ef;
            box-shadow: 0 0 0 3px rgba(45, 137, 239, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .radio-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            background: #f9f9f9;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .radio-option:hover {
            background: #f0f7ff;
        }

        .radio-option.selected {
            background: #e8f4ff;
            border-color: #2d89ef;
        }

        input[type="radio"] {
            display: none;
        }

        .custom-radio {
            width: 18px;
            height: 18px;
            border: 2px solid #ccc;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .radio-option.selected .custom-radio {
            border-color: #2d89ef;
            background-color: #2d89ef;
        }

        .custom-radio:after {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: white;
            display: none;
        }

        .radio-option.selected .custom-radio:after {
            display: block;
        }

        .radio-label {
            cursor: pointer;
            flex-grow: 1;
            font-size: 0.95rem;
        }

        .radio-label small {
            display: block;
            color: #666;
            font-size: 0.85rem;
            margin-top: 2px;
        }

        .inline-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .inline-field {
            display: flex;
            flex-direction: column;
        }

        .inline-field label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .inline-field input, .inline-field select {
            padding: 10px 12px;
            font-size: 0.95rem;
        }

        .difficulty-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
            border-left: 4px solid #2d89ef;
        }

        .difficulty-slider-container {
            margin-top: 15px;
        }

        .difficulty-value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2d89ef;
            text-align: center;
            margin-bottom: 10px;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #4CAF50, #8BC34A, #FFC107, #FF9800, #f44336);
            outline: none;
            margin: 10px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #2d89ef;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .difficulty-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #666;
        }

        .difficulty-label {
            text-align: center;
            padding: 5px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
            flex: 1;
            max-width: 60px;
        }

        .difficulty-label:hover {
            background: #f0f0f0;
        }

        .difficulty-label.active {
            background: #e8f4ff;
            color: #2d89ef;
            font-weight: 600;
        }

        .difficulty-description {
            margin-top: 15px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #666;
            border: 1px solid #e0e0e0;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            background: #f9f9f9;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .checkbox-option:hover {
            background: #f0f7ff;
        }

        .checkbox-option.selected {
            background: #e8f4ff;
            border-color: #2d89ef;
        }

        .custom-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 4px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .checkbox-option.selected .custom-checkbox {
            border-color: #2d89ef;
            background-color: #2d89ef;
        }

        .custom-checkbox:after {
            content: '✓';
            color: white;
            font-weight: bold;
            font-size: 14px;
            display: none;
        }

        .checkbox-option.selected .custom-checkbox:after {
            display: block;
        }

        .checkbox-label {
            cursor: pointer;
            flex-grow: 1;
            font-size: 0.9rem;
        }

        .price-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .price-label {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .price-amount {
            font-size: 3rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .price-min {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .price-breakdown {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.95rem;
        }

        .breakdown-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.1rem;
            color: #2d89ef;
            padding-top: 12px;
            margin-top: 5px;
            border-top: 2px solid #eee;
        }

        .breakdown-label {
            color: #666;
        }

        .breakdown-value {
            font-weight: 600;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-calculate {
            background: #2d89ef;
            color: white;
        }

        .btn-calculate:hover {
            background: #1a7ae0;
            transform: translateY(-2px);
        }

        .btn-create-order {
            background: #4CAF50;
            color: white;
            margin-top: 20px;
        }

        .btn-create-order:hover {
            background: #3d8b40;
            transform: translateY(-2px);
        }

        .btn-reset {
            background: #f0f0f0;
            color: #333;
        }

        .btn-reset:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        .btn-next-step {
            background: #FF9800;
            color: white;
            margin-top: 15px;
        }

        .btn-next-step:hover {
            background: #e68900;
            transform: translateY(-2px);
        }

        .status {
            display: none;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-size: 0.95rem;
            text-align: center;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            color: #2d89ef;
            font-size: 0.95rem;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
            text-decoration: none;
            border: none;
            font-size: 0.95rem;
        }

        .action-btn.copy {
            background: #4CAF50;
            color: white;
        }

        .action-btn.copy:hover {
            background: #3d8b40;
            transform: translateY(-2px);
        }

        .action-btn.telegram {
            background: #0088cc;
            color: white;
        }

        .action-btn.telegram:hover {
            background: #0077b5;
            transform: translateY(-2px);
        }

        .action-btn.new {
            background: #FF9800;
            color: white;
        }

        .action-btn.new:hover {
            background: #e68900;
            transform: translateY(-2px);
        }

        .result-area {
            margin-top: 20px;
            background: #f1f1f1;
            padding: 20px;
            border-radius: 10px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            color: #2d89ef;
            cursor: help;
        }

        .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
            z-index: 1000;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .field-note {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .required::after {
            content: " *";
            color: #f44336;
        }

        .manager-only {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.95rem;
            color: #856404;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ddd;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s;
        }

        .step.active .step-circle {
            background: #2d89ef;
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-circle {
            background: #4CAF50;
            color: white;
        }

        .step-label {
            font-size: 0.85rem;
            color: #666;
        }

        .step.active .step-label {
            color: #2d89ef;
            font-weight: 600;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }

        .next-step-notice {
            background: #e8f4ff;
            border: 1px solid #2d89ef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            font-size: 0.95rem;
            display: none;
        }

        .coefficient-scale {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .scale-item {
            text-align: center;
            flex: 1;
        }

        .scale-level {
            font-weight: bold;
            color: #2d89ef;
        }

        .scale-percent {
            color: #666;
            font-size: 0.8rem;
        }

        .difficulty-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .difficulty-example {
            background: white;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            border-left: 3px solid #ddd;
        }

        .difficulty-example.level-1 { border-left-color: #4CAF50; }
        .difficulty-example.level-3 { border-left-color: #FFC107; }
        .difficulty-example.level-5 { border-left-color: #FF9800; }
        .difficulty-example.level-7 { border-left-color: #FF5722; }
        .difficulty-example.level-10 { border-left-color: #f44336; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <i class="fas fa-calculator"></i>
                Система расчета и оформления заявок
                <i class="fas fa-file-invoice-dollar"></i>
            </h1>
            <p>Для менеджеров клининговой компании</p>
            
            <div class="manager-info">
                <div class="manager-input">
                    <div class="manager-badge">
                        <i class="fas fa-user-tie"></i>
                        Менеджер:
                    </div>
                    <input type="text" id="managerName" placeholder="Введите ваше имя" maxlength="50" value="Менеджер">
                </div>
                <div class="field-note">Имя менеджера будет указано в заявке</div>
            </div>
        </header>

        <div class="step-indicator">
            <div class="step active" id="step1">
                <div class="step-circle">1</div>
                <div class="step-label">Расчет стоимости</div>
            </div>
            <div class="step" id="step2">
                <div class="step-circle">2</div>
                <div class="step-label">Заполнение заявки</div>
            </div>
            <div class="step" id="step3">
                <div class="step-circle">3</div>
                <div class="step-label">Оформление</div>
            </div>
        </div>

        <div class="manager-only">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Внимание менеджера!</strong> Коэффициент сложности: 1-5 (макс +35%), 6-10 (до +100%). Уровень 1 - стандартная уборка, уровень 5 - сложные условия с животными, уровень 10 - экстремальные случаи.
        </div>

        <div class="system-container">
            <!-- ЛЕВАЯ КОЛОНКА: КАЛЬКУЛЯТОР -->
            <div class="calculator-section">
                <div class="section-header">
                    <h2><i class="fas fa-calculator"></i> Калькулятор стоимости</h2>
                    <div class="step-circle" style="width: 30px; height: 30px; background: #2d89ef; color: white;">1</div>
                </div>

                <div class="form-group">
                    <label class="required">Тип уборки <span class="hint">(выберите один)</span></label>
                    <div class="radio-group" id="cleaningType">
                        <div class="radio-option selected" data-value="maintenance" data-price="80">
                            <div class="custom-radio"></div>
                            <span class="radio-label">
                                Поддерживающая
                                <small>от 80 руб/м² • Стандартная уборка</small>
                            </span>
                        </div>
                        <div class="radio-option" data-value="general" data-price="100">
                            <div class="custom-radio"></div>
                            <span class="radio-label">
                                Генеральная
                                <small>от 100 руб/м² • Полная уборка</small>
                            </span>
                        </div>
                        <div class="radio-option" data-value="post-renovation" data-price="150">
                            <div class="custom-radio"></div>
                            <span class="radio-label">
                                После ремонта
                                <small>от 150 руб/м² • Строительная пыль, загрязнения</small>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="required">Площадь помещения <span class="hint">(в м²)</span></label>
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Площадь (м²)</label>
                            <input type="number" id="areaSize" min="10" max="1000" value="60" step="1" placeholder="Например: 85">
                        </div>
                        <div class="inline-field">
                            <label>Тип помещения</label>
                            <select id="roomType">
                                <option value="apartment" selected>Квартира</option>
                                <option value="office">Офис</option>
                                <option value="house">Дом</option>
                                <option value="industrial">Производственное</option>
                            </select>
                        </div>
                    </div>
                    <div class="field-note">Укажите точную площадь помещения для расчета</div>
                </div>

                <div class="difficulty-section">
                    <label class="required">Коэффициент сложности <span class="hint">(1-10, до +100%)</span></label>
                    
                    <div class="coefficient-scale">
                        <div class="scale-item">
                            <div class="scale-level">1</div>
                            <div class="scale-percent">+0%</div>
                        </div>
                        <div class="scale-item">
                            <div class="scale-level">3</div>
                            <div class="scale-percent">+20%</div>
                        </div>
                        <div class="scale-item">
                            <div class="scale-level">5</div>
                            <div class="scale-percent">+35%</div>
                        </div>
                        <div class="scale-item">
                            <div class="scale-level">7</div>
                            <div class="scale-percent">+60%</div>
                        </div>
                        <div class="scale-item">
                            <div class="scale-level">10</div>
                            <div class="scale-percent">+100%</div>
                        </div>
                    </div>
                    
                    <div class="difficulty-slider-container">
                        <div class="difficulty-value" id="difficultyValue">Уровень 1: Стандартная уборка (+0%)</div>
                        <input type="range" id="difficultySlider" min="1" max="10" value="1" step="1">
                        
                        <div class="difficulty-labels">
                            <div class="difficulty-label active" data-level="1">1</div>
                            <div class="difficulty-label" data-level="2">2</div>
                            <div class="difficulty-label" data-level="3">3</div>
                            <div class="difficulty-label" data-level="4">4</div>
                            <div class="difficulty-label" data-level="5">5</div>
                            <div class="difficulty-label" data-level="6">6</div>
                            <div class="difficulty-label" data-level="7">7</div>
                            <div class="difficulty-label" data-level="8">8</div>
                            <div class="difficulty-label" data-level="9">9</div>
                            <div class="difficulty-label" data-level="10">10</div>
                        </div>

                        <div class="difficulty-description">
                            <strong>Шкала сложности для менеджера:</strong>
                            <br>1-3: Стандартные условия
                            <br>4-5: Сложные условия (животные, много мебели)
                            <br>6-8: Очень сложные (сильные загрязнения)
                            <br>9-10: Экстремальные случаи (требуют особого подхода)
                        </div>

                        <div class="difficulty-examples">
                            <div class="difficulty-example level-1">
                                <strong>Уровень 1-2:</strong> Стандартная уборка, нормальное загрязнение
                            </div>
                            <div class="difficulty-example level-3">
                                <strong>Уровень 3-4:</strong> Среднее загрязнение, наличие животных
                            </div>
                            <div class="difficulty-example level-5">
                                <strong>Уровень 5-6:</strong> Сильное загрязнение, домашние животные
                            </div>
                            <div class="difficulty-example level-7">
                                <strong>Уровень 7-8:</strong> Очень сложные условия, много нюансов
                            </div>
                            <div class="difficulty-example level-10">
                                <strong>Уровень 9-10:</strong> Экстремальные случаи, особые требования
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Дополнительные услуги <span class="hint">(опционально)</span></label>
                    
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Окна (створки)</label>
                            <input type="number" id="windowsCount" min="0" value="0" placeholder="Кол-во">
                        </div>
                        <div class="inline-field">
                            <label>Тип мойки</label>
                            <select id="windowsType">
                                <option value="200">С одной стороны (200 руб)</option>
                                <option value="400">С двух сторон (400 руб)</option>
                            </select>
                        </div>
                    </div>

                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Шкафы (шт)</label>
                            <input type="number" id="cabinetsCount" min="0" value="0" placeholder="Кол-во">
                        </div>
                        <div class="inline-field">
                            <label>Холодильники (шт)</label>
                            <input type="number" id="fridgeCount" min="0" value="0" placeholder="Кол-во">
                        </div>
                    </div>

                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Духовые шкафы (шт)</label>
                            <input type="number" id="ovenCount" min="0" value="0" placeholder="Кол-во">
                        </div>
                        <div class="inline-field">
                            <label>Вытяжки (шт)</label>
                            <input type="number" id="hoodCount" min="0" value="0" placeholder="Кол-во">
                        </div>
                    </div>

                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Мелкая техника (шт)</label>
                            <input type="number" id="appliancesCount" min="0" value="0" placeholder="Кол-во">
                        </div>
                        <div class="inline-field">
                            <label>Дальний выезд</label>
                            <select id="farTrip">
                                <option value="0">Нет</option>
                                <option value="1000">Да (+1000 руб)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="price-display">
                    <div class="price-label">Ориентировочная стоимость:</div>
                    <div class="price-amount" id="totalPrice">0 руб</div>
                    <div class="price-min">*Минимальный заказ: 3 500 руб</div>
                </div>

                <div class="price-breakdown">
                    <div class="breakdown-item">
                        <span class="breakdown-label">Базовая уборка:</span>
                        <span class="breakdown-value" id="basePrice">0 руб</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Доп. услуги:</span>
                        <span class="breakdown-value" id="extraPrice">0 руб</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Коэффициент сложности:</span>
                        <span class="breakdown-value" id="difficultyPrice">+0%</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Итоговая стоимость:</span>
                        <span class="breakdown-value" id="finalPrice">0 руб</span>
                    </div>
                </div>

                <div class="buttons">
                    <button class="btn-calculate" id="calculateBtn">
                        <i class="fas fa-calculator"></i> Рассчитать стоимость
                    </button>
                    <button class="btn-reset" id="resetBtn">
                        <i class="fas fa-redo"></i> Сбросить
                    </button>
                </div>

                <button class="btn-next-step" id="nextStepBtn">
                    <i class="fas fa-arrow-right"></i> Перейти к оформлению заявки
                </button>

                <div class="next-step-notice" id="nextStepNotice">
                    <i class="fas fa-arrow-right"></i> <strong>Стоимость рассчитана!</strong> Перейдите к заполнению заявки справа.
                </div>
            </div>

            <!-- ПРАВАЯ КОЛОНКА: ФОРМА ЗАЯВКИ -->
            <div class="order-section" id="orderSection">
                <div class="section-header">
                    <h2><i class="fas fa-file-alt"></i> Форма заявки</h2>
                    <div class="step-circle" style="width: 30px; height: 30px; background: #ddd; color: #666;">2</div>
                </div>

                <div class="form-group">
                    <label class="required">Данные клиента</label>
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Имя клиента</label>
                            <input type="text" id="customerName" placeholder="Фамилия Имя">
                        </div>
                        <div class="inline-field">
                            <label>Телефон</label>
                            <input type="tel" id="customerPhone" placeholder="+7 (___) ___-____">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="required">Адрес уборки</label>
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Адрес</label>
                            <input type="text" id="customerAddress" placeholder="Улица, дом">
                        </div>
                        <div class="inline-field">
                            <label>Квартира/офис</label>
                            <input type="text" id="customerFlat" placeholder="Номер">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Дата и время уборки</label>
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Дата</label>
                            <input type="date" id="orderDate">
                        </div>
                        <div class="inline-field">
                            <label>Время</label>
                            <input type="time" id="orderTime">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Финансы <span class="hint">(автозаполнение из калькулятора)</span></label>
                    <div class="inline-fields">
                        <div class="inline-field">
                            <label>Сумма заказа</label>
                            <input type="number" id="orderTotal" placeholder="Автозаполнение" readonly>
                        </div>
                        <div class="inline-field">
                            <label>Зарплата мастерам</label>
                            <select id="masterPayType" onchange="calculateMasterPay()">
                                <option value="60">60/40</option>
                                <option value="70">70/30</option>
                                <option value="fixed">Фиксированная</option>
                            </select>
                            <input type="number" id="masterPay" placeholder="Сумма" style="margin-top: 8px;">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Оборудование</label>
                    <div class="checkbox-group" id="equipmentGroup">
                        <div class="checkbox-option" data-value="Стремянка">
                            <div class="custom-checkbox"></div>
                            <span class="checkbox-label">Стремянка</span>
                        </div>
                        <div class="checkbox-option" data-value="Пылесос">
                            <div class="custom-checkbox"></div>
                            <span class="checkbox-label">Пылесос</span>
                        </div>
                        <div class="checkbox-option" data-value="Парогенератор">
                            <div class="custom-checkbox"></div>
                            <span class="checkbox-label">Парогенератор</span>
                        </div>
                        <div class="checkbox-option" data-value="Мойщик окон">
                            <div class="custom-checkbox"></div>
                            <span class="checkbox-label">Мойщик окон</span>
                        </div>
                        <div class="checkbox-option" data-value="Ведро">
                            <div class="custom-checkbox"></div>
                            <span class="checkbox-label">Ведро</span>
                        </div>
                        <div class="checkbox-option" data-value="Мопы">
                            <div class="custom-checkbox"></div>
                            <span class="checkbox-label">Мопы</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Химия</label>
                    <div class="checkbox-group" id="chemistryGroup">
                        <div class="checkbox-option" data-value="Универсальное средство">
                            <div class="custom-checkbox"></div>
                            <span class="checkbox-label">Универсальное средство</span>
                        </div>
                        <div class="checkbox-option" data-value="Средство от жира">
                            <div class="custom-checkbox"></div>
                            <span class="checkbox-label">Средство от жира</span>
                        </div>
                        <div class="checkbox-option" data-value="Средство для сантехники">
                            <div class="custom-checkbox"></div>
                            <span class="checkbox-label">Средство для сантехники</span>
                        </div>
                        <div class="checkbox-option" data-value="Антискотч">
                            <div class="custom-checkbox"></div>
                            <span class="checkbox-label">Антискотч</span>
                        </div>
                        <div class="checkbox-option" data-value="Средство для окон">
                            <div class="custom-checkbox"></div>
                            <span class="checkbox-label">Средство для окон</span>
                        </div>
                        <div class="checkbox-option" data-value="Полироль для мебели">
                            <div class="custom-checkbox"></div>
                            <span class="checkbox-label">Полироль для мебели</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Описание работ</label>
                    <textarea id="worksDescription" placeholder="Дополнительные пожелания, особенности помещения..."></textarea>
                </div>

                <button class="btn-create-order" id="createOrderBtn">
                    <i class="fas fa-file-invoice-dollar"></i> Создать заявку
                </button>

                <div id="status" class="status"></div>
                <div id="loading" class="loading">⏳ Обработка данных...</div>

                <div id="resultArea" class="result-area" style="display: none;"></div>

                <div class="action-buttons" id="actionButtons" style="display: none;">
                    <button class="action-btn copy" onclick="copyToClipboard()">
                        <i class="far fa-copy"></i> Копировать
                    </button>
                    <button class="action-btn telegram" onclick="sendToTelegram()">
                        <i class="fab fa-telegram"></i> Telegram
                    </button>
                    <button class="action-btn new" onclick="newOrder()">
                        <i class="fas fa-plus"></i> Новая
                    </button>
                </div>
            </div>
        </div>

        <footer>
            <p>© 2023 Система расчета и оформления заявок. Для внутреннего использования менеджерами.</p>
            <p style="margin-top: 5px; font-size: 0.8rem;">Все расчеты являются предварительными. Точную стоимость определяет менеджер.</p>
        </footer>
    </div>

    <script>
        // Константы
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwbAWTpykj4kPODmOdMvac5pPkouYlJWnOvQLtN-UUTChbjBf9VYwGaKVhfV0lnKlbU/exec';

        // Цены и коэффициенты (1-10, где 5 = +35%, 10 = +100%)
        const priceConfig = {
            cleaningTypes: {
                'maintenance': 80,
                'general': 100,
                'post-renovation': 150
            },
            extras: {
                'windows': { '200': 200, '400': 400 },
                'cabinets': 250,
                'fridge': 600,
                'oven': 500,
                'hood': 300,
                'appliances': 100,
                'farTrip': 1000
            },
            minOrder: 3500,
            // Коэффициент сложности 1-10:
            difficulty: {
                1: 1.00,   // +0%
                2: 1.09,   // +9%
                3: 1.20,   // +20%
                4: 1.28,   // +28%
                5: 1.35,   // +35%
                6: 1.48,   // +48%
                7: 1.60,   // +60%
                8: 1.75,   // +75%
                9: 1.88,   // +88%
                10: 2.00   // +100%
            },
            difficultyDescriptions: {
                1: "Уровень 1: Стандартная уборка, нормальное загрязнение (+0%)",
                2: "Уровень 2: Легкие дополнительные загрязнения (+9%)",
                3: "Уровень 3: Среднее загрязнение, наличие животных (+20%)",
                4: "Уровень 4: Сильное загрязнение, много мебели (+28%)",
                5: "Уровень 5: Домашние животные, сложные условия (+35%)",
                6: "Уровень 6: Очень сложные условия, сильные загрязнения (+48%)",
                7: "Уровень 7: Экстремальные случаи, особые требования (+60%)",
                8: "Уровень 8: Сверхсложные условия, много нюансов (+75%)",
                9: "Уровень 9: Исключительно сложные случаи (+88%)",
                10: "Уровень 10: Максимальная сложность, особый подход (+100%)"
            },
            difficultyShortDesc: {
                1: "Стандартная уборка",
                2: "Легкие загрязнения",
                3: "Средние загрязнения",
                4: "Сильные загрязнения",
                5: "Животные, сложные условия",
                6: "Очень сложные",
                7: "Экстремальные случаи",
                8: "Сверхсложные",
                9: "Исключительно сложные",
                10: "Максимальная сложность"
            }
        };

        // Глобальные переменные
        let currentOrderData = null;
        let calculatedPrice = 0;

        // DOM элементы
        const managerNameInput = document.getElementById('managerName');
        const cleaningTypeOptions = document.querySelectorAll('#cleaningType .radio-option');
        const areaSizeInput = document.getElementById('areaSize');
        const roomTypeSelect = document.getElementById('roomType');
        const difficultySlider = document.getElementById('difficultySlider');
        const difficultyValue = document.getElementById('difficultyValue');
        const difficultyLabels = document.querySelectorAll('.difficulty-label');
        
        // Дополнительные услуги
        const windowsCount = document.getElementById('windowsCount');
        const windowsType = document.getElementById('windowsType');
        const cabinetsCount = document.getElementById('cabinetsCount');
        const fridgeCount = document.getElementById('fridgeCount');
        const ovenCount = document.getElementById('ovenCount');
        const hoodCount = document.getElementById('hoodCount');
        const appliancesCount = document.getElementById('appliancesCount');
        const farTrip = document.getElementById('farTrip');
        
        // Форма заявки
        const customerName = document.getElementById('customerName');
        const customerPhone = document.getElementById('customerPhone');
        const customerAddress = document.getElementById('customerAddress');
        const customerFlat = document.getElementById('customerFlat');
        const orderDate = document.getElementById('orderDate');
        const orderTime = document.getElementById('orderTime');
        const orderTotal = document.getElementById('orderTotal');
        const masterPayType = document.getElementById('masterPayType');
        const masterPay = document.getElementById('masterPay');
        const worksDescription = document.getElementById('worksDescription');
        
        // Чекбоксы оборудования и химии
        const equipmentOptions = document.querySelectorAll('#equipmentGroup .checkbox-option');
        const chemistryOptions = document.querySelectorAll('#chemistryGroup .checkbox-option');
        
        // Кнопки
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const createOrderBtn = document.getElementById('createOrderBtn');
        const nextStepBtn = document.getElementById('nextStepBtn');
        
        // Отображение цены
        const totalPriceEl = document.getElementById('totalPrice');
        const basePriceEl = document.getElementById('basePrice');
        const extraPriceEl = document.getElementById('extraPrice');
        const difficultyPriceEl = document.getElementById('difficultyPrice');
        const finalPriceEl = document.getElementById('finalPrice');
        
        // Статус и результат
        const statusEl = document.getElementById('status');
        const loadingEl = document.getElementById('loading');
        const resultArea = document.getElementById('resultArea');
        const actionButtons = document.getElementById('actionButtons');
        
        // Элементы для навигации
        const orderSection = document.getElementById('orderSection');
        const nextStepNotice = document.getElementById('nextStepNotice');
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Установка сегодняшней даты по умолчанию
            const today = new Date();
            orderDate.value = today.toISOString().split('T')[0];
            
            // Установка времени по умолчанию (через 2 часа)
            const twoHoursLater = new Date(today.getTime() + 2 * 60 * 60 * 1000);
            orderTime.value = twoHoursLater.toISOString().split('T')[1].substring(0, 5);
            
            // Обновление слайдера сложности
            updateDifficultyDisplay();
            
            // Обработчики событий для калькулятора
            cleaningTypeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    cleaningTypeOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    calculatePrice();
                });
            });

            areaSizeInput.addEventListener('input', calculatePrice);
            roomTypeSelect.addEventListener('change', calculatePrice);
            difficultySlider.addEventListener('input', updateDifficultyDisplay);
            
            // Обработчики для меток сложности
            difficultyLabels.forEach(label => {
                label.addEventListener('click', function() {
                    const level = parseInt(this.getAttribute('data-level'));
                    difficultySlider.value = level;
                    updateDifficultyDisplay();
                    calculatePrice();
                });
            });
            
            // Обработчики для дополнительных услуг
            const extraInputs = [windowsCount, windowsType, cabinetsCount, fridgeCount, 
                               ovenCount, hoodCount, appliancesCount, farTrip];
            extraInputs.forEach(input => {
                input.addEventListener('change', calculatePrice);
                input.addEventListener('input', calculatePrice);
            });
            
            // Обработчики для чекбоксов оборудования
            equipmentOptions.forEach(option => {
                option.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });
            
            // Обработчики для чекбоксов химии
            chemistryOptions.forEach(option => {
                option.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });
            
            // Кнопка расчета
            calculateBtn.addEventListener('click', function() {
                calculatePrice();
                showNextStepNotice();
            });
            
            // Кнопка сброса
            resetBtn.addEventListener('click', resetCalculator);
            
            // Кнопка следующего шага
            nextStepBtn.addEventListener('click', showOrderForm);
            
            // Кнопка создания заявки
            createOrderBtn.addEventListener('click', createOrder);
            
            // Автоматический расчет при загрузке
            calculatePrice();
        });

        // Показать уведомление о переходе к следующему шагу
        function showNextStepNotice() {
            nextStepNotice.style.display = 'block';
            setTimeout(() => {
                nextStepNotice.style.display = 'none';
            }, 5000);
        }

        // Перейти к форме заявки
        function showOrderForm() {
            // Активируем шаг 2
            step2.classList.add('active');
            step1.classList.remove('active');
            step1.classList.add('completed');
            
            // Активируем правую колонку
            orderSection.classList.add('active');
            
            // Прокручиваем к форме заявки
            orderSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Фокусируем первое поле формы
            customerName.focus();
            
            showStatus('Перешли к заполнению заявки. Заполните данные клиента.', 'info');
        }

        // Обновление отображения сложности
        function updateDifficultyDisplay() {
            const level = parseInt(difficultySlider.value);
            const percentage = Math.round((priceConfig.difficulty[level] - 1) * 100);
            
            difficultyValue.textContent = `Уровень ${level}: ${priceConfig.difficultyShortDesc[level]} (+${percentage}%)`;
            
            // Обновление активных меток
            difficultyLabels.forEach(label => {
                const labelLevel = parseInt(label.getAttribute('data-level'));
                label.classList.toggle('active', labelLevel === level);
            });
        }

        // Расчет стоимости
        function calculatePrice() {
            // Получаем значения
            const cleaningType = document.querySelector('#cleaningType .radio-option.selected').getAttribute('data-value');
            const area = parseInt(areaSizeInput.value) || 10;
            const difficulty = parseInt(difficultySlider.value);
            
            // 1. Базовая стоимость
            let basePrice = priceConfig.cleaningTypes[cleaningType] * area;
            
            // 2. Дополнительные услуги
            let extraPrice = 0;
            
            // Окна
            const windowsPrice = parseInt(windowsType.value);
            extraPrice += (parseInt(windowsCount.value) || 0) * windowsPrice;
            
            // Другие услуги
            extraPrice += (parseInt(cabinetsCount.value) || 0) * priceConfig.extras.cabinets;
            extraPrice += (parseInt(fridgeCount.value) || 0) * priceConfig.extras.fridge;
            extraPrice += (parseInt(ovenCount.value) || 0) * priceConfig.extras.oven;
            extraPrice += (parseInt(hoodCount.value) || 0) * priceConfig.extras.hood;
            extraPrice += (parseInt(appliancesCount.value) || 0) * priceConfig.extras.appliances;
            
            // Дальний выезд
            if (farTrip.value === '1000') {
                extraPrice += priceConfig.extras.farTrip;
            }
            
            // 3. Общая стоимость до коэффициента
            let subtotal = basePrice + extraPrice;
            
            // 4. Минимальная сумма
            if (subtotal < priceConfig.minOrder) {
                subtotal = priceConfig.minOrder;
            }
            
            // 5. Применяем коэффициент сложности (1-10)
            const difficultyMultiplier = priceConfig.difficulty[difficulty];
            let finalPrice = subtotal * difficultyMultiplier;
            
            // 6. Сохраняем расчетную цену
            calculatedPrice = finalPrice;
            
            // 7. Заполняем поле суммы в форме заявки
            orderTotal.value = Math.round(finalPrice);
            calculateMasterPay();
            
            // 8. Отображаем результаты
            displayPriceResults(basePrice, extraPrice, difficultyMultiplier, finalPrice);
        }

        // Отображение результатов расчета
        function displayPriceResults(basePrice, extraPrice, difficultyMultiplier, finalPrice) {
            const percentage = Math.round((difficultyMultiplier - 1) * 100);
            
            basePriceEl.textContent = formatPrice(basePrice);
            extraPriceEl.textContent = formatPrice(extraPrice);
            difficultyPriceEl.textContent = `+${percentage}%`;
            finalPriceEl.textContent = formatPrice(finalPrice);
            totalPriceEl.textContent = formatPrice(finalPrice);
        }

        // Форматирование цены
        function formatPrice(price) {
            return Math.round(price).toLocaleString('ru-RU') + ' руб';
        }

        // Расчет зарплаты мастерам
        function calculateMasterPay() {
            const total = parseFloat(orderTotal.value) || 0;
            const type = masterPayType.value;
            
            if (type === '60') {
                masterPay.value = Math.round(total * 0.6);
            } else if (type === '70') {
                masterPay.value = Math.round(total * 0.7);
            } else if (type === 'fixed') {
                // Оставляем пустым для ручного ввода
                if (!masterPay.value) masterPay.value = '';
            }
        }

        // Сброс калькулятора
        function resetCalculator() {
            // Сброс типа уборки
            cleaningTypeOptions.forEach(opt => opt.classList.remove('selected'));
            document.querySelector('#cleaningType .radio-option').classList.add('selected');
            
            // Сброс площади
            areaSizeInput.value = '60';
            roomTypeSelect.value = 'apartment';
            
            // Сброс сложности
            difficultySlider.value = '1';
            updateDifficultyDisplay();
            
            // Сброс дополнительных услуг
            windowsCount.value = '0';
            windowsType.value = '200';
            cabinetsCount.value = '0';
            fridgeCount.value = '0';
            ovenCount.value = '0';
            hoodCount.value = '0';
            appliancesCount.value = '0';
            farTrip.value = '0';
            
            // Сброс чекбоксов
            equipmentOptions.forEach(opt => opt.classList.remove('selected'));
            chemistryOptions.forEach(opt => opt.classList.remove('selected'));
            
            calculatePrice();
            
            showStatus('Калькулятор сброшен', 'success');
        }

        // Показать статус
        function showStatus(message, type = 'success') {
            statusEl.className = 'status ' + type;
            statusEl.innerHTML = message;
            statusEl.style.display = 'block';
            
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }

        // Создание заявки
        function createOrder() {
            // Проверка менеджера
            const manager = managerNameInput.value.trim();
            if (!manager) {
                showStatus('❌ Укажите имя менеджера!', 'error');
                managerNameInput.focus();
                return;
            }
            
            // Проверка обязательных полей
            if (!customerName.value.trim()) {
                showStatus('❌ Укажите имя клиента!', 'error');
                customerName.focus();
                return;
            }
            
            if (!customerPhone.value.trim()) {
                showStatus('❌ Укажите телефон клиента!', 'error');
                customerPhone.focus();
                return;
            }
            
            if (!customerAddress.value.trim()) {
                showStatus('❌ Укажите адрес уборки!', 'error');
                customerAddress.focus();
                return;
            }
            
            // Генерация ID заказа
            const orderId = generateOrderId();
            
            // Получение выбранного оборудования
            const equipment = [];
            equipmentOptions.forEach(option => {
                if (option.classList.contains('selected')) {
                    equipment.push(option.getAttribute('data-value'));
                }
            });
            
            // Получение выбранной химии
            const chemistry = [];
            chemistryOptions.forEach(option => {
                if (option.classList.contains('selected')) {
                    chemistry.push(option.getAttribute('data-value'));
                }
            });
            
            // Получаем тип уборки по-русски
            let cleaningTypeText = '';
            switch(document.querySelector('#cleaningType .radio-option.selected').getAttribute('data-value')) {
                case 'maintenance': cleaningTypeText = 'Поддерживающая'; break;
                case 'general': cleaningTypeText = 'Генеральная'; break;
                case 'post-renovation': cleaningTypeText = 'После ремонта'; break;
            }
            
            // Подготовка данных для отправки
            currentOrderData = {
                // Информация о менеджере
                manager: manager,
                orderId: orderId,
                
                // Данные калькулятора
                cleaningType: cleaningTypeText,
                area: parseInt(areaSizeInput.value) || 0,
                roomType: roomTypeSelect.options[roomTypeSelect.selectedIndex].text,
                difficulty: parseInt(difficultySlider.value),
                difficultyPercent: Math.round((priceConfig.difficulty[parseInt(difficultySlider.value)] - 1) * 100),
                calculatedPrice: calculatedPrice,
                
                // Дополнительные услуги
                windowsCount: parseInt(windowsCount.value) || 0,
                windowsType: windowsType.options[windowsType.selectedIndex].text,
                cabinetsCount: parseInt(cabinetsCount.value) || 0,
                fridgeCount: parseInt(fridgeCount.value) || 0,
                ovenCount: parseInt(ovenCount.value) || 0,
                hoodCount: parseInt(hoodCount.value) || 0,
                appliancesCount: parseInt(appliancesCount.value) || 0,
                farTrip: farTrip.value === '1000' ? 'Да' : 'Нет',
                
                // Данные клиента
                customerName: customerName.value,
                customerPhone: customerPhone.value,
                customerAddress: customerAddress.value,
                customerFlat: customerFlat.value,
                orderDate: orderDate.value,
                orderTime: orderTime.value,
                orderTotal: orderTotal.value || '0',
                masterPay: masterPay.value || '0',
                worksDescription: worksDescription.value || '',
                equipment: equipment.join(', ') || '—',
                chemistry: chemistry.join(', ') || '—'
            };
            
            // Генерация текста заявки
            generateOrderText();
            
            // Активируем шаг 3
            step3.classList.add('active');
            step2.classList.remove('active');
            step2.classList.add('completed');
            
            // Показать кнопки действий
            resultArea.style.display = 'block';
            actionButtons.style.display = 'flex';
            
            // Прокрутить к результату
            resultArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Автоматическая отправка в Google Таблицы
            saveToSheets();
        }

        // Генерация ID заказа
        function generateOrderId() {
            return 'CLN-' + Date.now().toString().slice(-8);
        }

        // Генерация текста заявки (без времени создания заявки)
        function generateOrderText() {
            if (!currentOrderData) return;
            
            const text = 
`🧹 ЗАКАЗ НА УБОРКУ №${currentOrderData.orderId}

📋 ОБЩАЯ ИНФОРМАЦИЯ:
────────────────────
Менеджер: ${currentOrderData.manager}
Тип уборки: ${currentOrderData.cleaningType}
Площадь: ${currentOrderData.area} м²
Тип помещения: ${currentOrderData.roomType}
Коэффициент сложности: Уровень ${currentOrderData.difficulty} (+${currentOrderData.difficultyPercent}%)
Дата: ${currentOrderData.orderDate}
Время: ${currentOrderData.orderTime}

💰 ФИНАНСЫ:
──────────
Расчетная стоимость: ${formatPrice(currentOrderData.calculatedPrice)}
Сумма заказа: ${currentOrderData.orderTotal} руб
Зарплата мастерам: ${currentOrderData.masterPay} руб

👤 ДАННЫЕ КЛИЕНТА:
─────────────────
Имя: ${currentOrderData.customerName}
Телефон: ${currentOrderData.customerPhone}
Адрес: ${currentOrderData.customerAddress}
Квартира/офис: ${currentOrderData.customerFlat || '—'}

🔧 ДОПОЛНИТЕЛЬНЫЕ УСЛУГИ:
────────────────────────
Окна: ${currentOrderData.windowsCount} шт (${currentOrderData.windowsType})
Шкафы: ${currentOrderData.cabinetsCount} шт
Холодильники: ${currentOrderData.fridgeCount} шт
Духовые шкафы: ${currentOrderData.ovenCount} шт
Вытяжки: ${currentOrderData.hoodCount} шт
Мелкая техника: ${currentOrderData.appliancesCount} шт
Дальний выезд: ${currentOrderData.farTrip}

🛠 ОБОРУДОВАНИЕ:
────────────────
${currentOrderData.equipment}

🧴 ХИМИЯ:
─────────
${currentOrderData.chemistry}

📝 ОПИСАНИЕ РАБОТ:
─────────────────
${currentOrderData.worksDescription || '—'}

📷 Фото будут прикреплены в чате`;

            resultArea.textContent = text;
        }

        // Копирование в буфер обмена
        function copyToClipboard() {
            const text = resultArea.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showStatus('✅ Текст заявки скопирован в буфер обмена!', 'success');
            }).catch(err => {
                console.error('Ошибка копирования: ', err);
                showStatus('❌ Не удалось скопировать текст', 'error');
            });
        }

        // Отправка в Telegram
        function sendToTelegram() {
            if (!currentOrderData) {
                showStatus('❌ Сначала создайте заявку', 'error');
                return;
            }
            
            const text = resultArea.textContent;
            const telegramUrl = `https://t.me/share/url?url=&text=${encodeURIComponent(text)}`;
            window.open(telegramUrl, '_blank');
            showStatus('📨 Telegram открыт для отправки заявки', 'success');
        }

        // Новая заявка
        function newOrder() {
            // Сброс только формы клиента
            customerName.value = '';
            customerPhone.value = '';
            customerAddress.value = '';
            customerFlat.value = '';
            worksDescription.value = '';
            
            // Сброс чекбоксов
            equipmentOptions.forEach(opt => opt.classList.remove('selected'));
            chemistryOptions.forEach(opt => opt.classList.remove('selected'));
            
            // Сброс шагов
            step1.classList.add('active');
            step1.classList.remove('completed');
            step2.classList.remove('active', 'completed');
            step3.classList.remove('active', 'completed');
            
            // Сброс правой колонки
            orderSection.classList.remove('active');
            
            // Скрываем результат
            resultArea.style.display = 'none';
            actionButtons.style.display = 'none';
            
            // Прокрутка к началу
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            showStatus('✅ Готово к созданию новой заявки! Начните с расчета стоимости.', 'success');
        }

        // Сохранение в Google Таблицы
        async function saveToSheets() {
            if (!currentOrderData) return;
            
            loadingEl.style.display = 'block';
            
            try {
                // Отправляем данные в Google Sheets
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(currentOrderData)
                });
                
                loadingEl.style.display = 'none';
                showStatus(`✅ Заявка №${currentOrderData.orderId} сохранена в Google Таблицу!`, 'success');
                
            } catch (error) {
                loadingEl.style.display = 'none';
                console.error('Ошибка:', error);
                
                // Альтернативный метод
                try {
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = GOOGLE_SCRIPT_URL;
                    form.target = '_blank';
                    
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'data';
                    input.value = JSON.stringify(currentOrderData);
                    form.appendChild(input);
                    
                    document.body.appendChild(form);
                    form.submit();
                    document.body.removeChild(form);
                    
                    showStatus(`✅ Заявка №${currentOrderData.orderId} отправлена (альтернативный метод)!`, 'success');
                } catch (e) {
                    showStatus('❌ Ошибка отправки в Google Таблицу', 'error');
                }
            }
        }
    </script>
</body>
</html>
